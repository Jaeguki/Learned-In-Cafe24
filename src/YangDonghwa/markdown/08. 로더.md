# 8. 로더
### 작성일
2019.05.14.

## 들어가기 전에
서블릿 컨테이너는 필요한 기능을 갖춘 별도의 전용 로더를 사용해야 하며, 시스템의 클래스 로더를 그대로 사용하면 안된다.

시스템의 클래스 로더를 사용할 경우, 서블릿이 운영중인 자바 가상 머신(JVM)의 CLASSPATH 변수에 잡혀있는 어떤 클래스나 라이브러리에 접근하는 것이 가능해지므로, **보안 문제** 가 발생할 수 있다. 서블릿은 오직 `WEB-INF/classes` 디렉토리 이하의 클래스와 `WEB-INF/lib` 디렉토리 내에 있는 라이브러리만 사용해야 한다.

또 다른 이유는 `WEB-INF/classes`나 `WEB-INF/lib` 디렉토리에 있는 클래스가 변경될 때마다 **자동으로 재로딩하는 기능** 을 지원해야 하기 때문이다. 톰캣의 로더를 구현하는 클래스 로더는 서블릿과 기타 클래스 파일들의 타임스탬프를 지속적으로 확인하기 위해 별도의 스레드를 사용한다.

### 인터페이스
인터페이스 | 기능
--- | ---
`org.apache.catalina.Loader` | 로더 인터페이스
`org.apache.catalina.loader.Reloader` | 자동 재로딩 지원하기 위해 구현해야 하는 인터페이스

### 주 용어
- 저장소(repository)
   - 클래스 로더가 찾아야 할 장소
- 자원(resource)
   - 컨텍스트 문서 루트에 대한 정보를 갖고 있는 클래스 로더의 DirContext 객체


## 자바 클래스 로더
자바 클래스의 인스턴스를 생성할 때마다 해당 클래스는 메모리에 로드된다. JVM은 클래스를 로드할 때 클래스 로더를 사용한다. 대부분의 클래스 로더는 자바의 핵심 라이브러리와 CLASSPATH 환경변수에 잡혀 있는 모든 라이브러리를 찾는다. 그러나 필요한 클래스를 찾지 못했을 경우엔 `java.lang.ClassNotFoundException`을 발생시킨다.

J2SE 1.2부터 JVM에는 **부트스트랩 클래스 로더, 확장 클래스 로더, 시스템 클래스 로더** 라고 하는 클래스 로더가 생겼다. 이 3개의 클래스 로더는 모두 계층 관계를 이루고 있는, 가장 상위에 있는 것은 부트스트랩 클래스 로더, 가장 하위에 있는 것은 시스템 클래스 로더이다.

로더 이름 | 설명
--- | ---
부트스트랩 클래스 로더<br>(bootstrap class loader) | JVM 시작 시 사용된다.<br>JVM이 올바르게 작동하려면 필요한 클래스를 초기에 로드해야 하므로, 원시 코드(native code)를 구현해야 한다.<br>`java.lang`이나 `java.io`패키지 등에 속하는 자바의 모든 핵심 클래스를 로드할 책임이 있는데, 이를 위해 rt.jar나 i18n.jar와 같은 핵심 라이브러리를 찾는다.
확장 클래스 로더<br>(extension class loader) | 표준 확장 디렉토리에 있는 클래스들을 로드하는 역할을 한다.
시스템 클래스 로더<br>(system class loader) | 애플리케이션이 사용하는 클래스를 로드한다.

## 요약
로거 컴포넌트에 대한 내용, `org.apache.catalina.Logger` 인터페이스, 톰캣이 갖고 있는 3개의 Logger 구현 클래스(SystemOutLogger, SystemErrLogger, FileLogger)를 살펴봤다.


### 참고 문헌
- 톰캣 최종분석
