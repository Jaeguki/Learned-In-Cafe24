# 1. 간단한 웹 서버
### 작성일
2019.05.07.


## Hypertext Transfer Protocol(HTTP)
- 인터넷에서 웹 서버와 브라우저가 데이터를 주고받는 데 필요한 프로토콜
- 요청/응답 방식
- 신뢰성 높은 TCP 연결 사용, 포트 80번 기본 사용

### HTTP 버전 비교
버전 | 0.9 | 1.0 | 1.1 | 2.0
--- | --- | --- | --- | ---
설명 | 원-라인 프로토콜 | 확장성 만들기 | 표준 프로토콜 | 더 나은 성능을 위한 프로토콜
요청 | 단일 라인의 요청, 리소스에 대한 경로로 가능한 메서드는 GET이 유일 | 버전 정보가 각 요청 사이내로 전송되기 시작함 | 파이프라이닝을 추가하여, 첫 번째 요청에 대한 응답이 완전히 전송되기 이전에 두 번째 요청 전송을 가능케 하여, 커뮤니케이션 지연 시간(latency)을 낮춤 | 병렬 요청이 동일한 커넥션 상에서 다루어질 수 있는 다중화 프로토콜로, 순서를 제거해주고 HTTP/1.x 프로토콜의 제약사항을 막아줌<br>전송된 데이터의 분명한 중복과 그런 데이터로부터 유발된 불필요한 오버헤드를 제거하면서, 연속된 요청 사이의 매우 유사한 내용으로 존재하는 헤더들을 압축시킨다.
응답 | 헤더의 존재 없이 HTML 파일만 전송됨 | 헤더가 생김. 상태 코드 라인이 응답의 시작 부분에 붙어 전송됨: 브라우저가 요청의 결과에 대한 동작을 할 수 있게 됨 | Host 헤더로 인해, 동일 IP 주소에 다른 도메인을 호스트하는 기능이 서버 코로케이션을 가능케 한다. | 서버로 하여금 사전에 클라이언트 캐시를 서버 푸쉬라고 불리는 메커니즘에 의해, 필요하게 될 데이터로 채워넣도록 허용한다.
추가된 기능 | . | 헤더의 존재로, HTML 파일들 외에 다른 문서들을 전송하는 기능이 추가됨(Content-Type) | 언어, 인코딩 혹은 타입을 포함한 컨텐츠 협상이 도입되어, 클라이언트와 서버로 하여금 교환하려는 가장 적합한 컨텐츠에 대한 동의를 가능하게 함<br>커넥션이 재사용될 수 있게 하여, 웹페이지 탐색 시간을 절약함 | 텍스트 프로토콜이라기보다는 이진 프로토콜로, 더 이상 읽을 수도 없고 수작업을 만들어낼 수 없다. 이런 결점에 대한 보상으로 새로운 최적화 기술이 구현될 수 있다.


## HTTP 요청
- 구성
   - 메소드 - URI(Uniform Resource Identifier) - 프로토콜/버전
   - 요청 헤더(Request header): 클라이언트 환경에 대한 유용한 정보(브라우저에 설정되어 있는 언어, 문서 본체의 길이 등)를 포함한다. 각각의 개별 헤더 정보는 캐리지 리턴과 개행 문자(CRLF)로 구분된다.
   - 헤더와 본체 사이에는 빈 줄이 하나 존재하는데, 이것이 헤더와 본체를 구분한다.
   - 문서 본체(Entity body)


## HTTP 응답
- 구성
   - 프로토콜 - 상태 코드(Status code) - 설명(description)
   - 응답 헤더(Response header): 요청 헤더와 마찬가지로 클라이언트에게 유용한 정보를 포함한다.
   - 여기에도 헤더와 본체 사이에 빈 줄을 삽입하여 둘을 구분한다.
   - 문서 본체(Entity body): HTML 컨텐트 자체


## Socket 클래스
- 소켓: 네트워크 연결에 있어서의 끝점(endpoint)에 해당하며, 애플리케이션은 소켓을 사용해 네트워크에 데이터를 읽거나 쓸 수 있다.
- 소프트웨어 애플리케이션은 네트워크 연결을 통해 바이트 스트림(byte stream)을 전송하고 수신함으로써 서로간에 통신이 가능하다.
- 메시지를 전달하려면 상대방 컴퓨터의 **IP**와 상대방 애플리케이션 소켓이 사용하는 **포트 번호**를 알아야 한다.
- Java - `java.net.Socket`: 어디에서든 원격 서버 애플리케이션에 연결할 수 있는 '클라이언트' 소켓을 나타낸다.


## ServerSocket 클래스
- 서버 애플리케이션의 경우, 클라이언트가 언제 접속을 시도할지 알 수 없는 상태에서 항상 대기하고 있어야 한다.
- Java - `java.net.ServerSocket`
- 클라이언트의 연결 요청을 기다리다가 연결 요청을 받아들이면, 서버 소켓을 Socket 인스턴스를 생성해 클라이언트와의 통신을 처리하게 한다.
- 리스닝 할 IP 주소(=바인딩 주소(`java.net.InetAddress`)), 포트 번호, 백로그(연결 요청의 최대 큐 길이(=수락할 수 있는 연결 요청의 최대 개수))


### 참고 문헌
- 톰캣 최종분석
- [HTTP의 진화](https://developer.mozilla.org/ko/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP)
